# Environment Management Guide

This project uses a sophisticated environment management system that allows seamless switching between development, staging, and production configurations.

## Quick Start

### Check Current Environment
```bash
pnpm env:check
```

### Switch Environments
```bash
# Switch to development
pnpm env:switch development

# Switch to production  
pnpm env:switch production

# Switch to staging
pnpm env:switch staging
```

### Development Commands
```bash
# Development mode (uses .env.development)
pnpm dev

# Development with production config (for testing)
pnpm dev:prod

# Preview production build locally
pnpm preview:prod
```

### Build Commands
```bash
# Production build
pnpm build

# Development build (with debug features)
pnpm build:dev

# Staging build
pnpm build:staging
```

## Environment Files

### `.env.development`
- **API URL**: `http://localhost:3001/api`
- **Debug Mode**: Enabled
- **Analytics**: Disabled
- **Dev Tools**: Enabled

### `.env.staging`  
- **API URL**: `https://staging-api.eagerdevelopers.ir/v1`
- **Debug Mode**: Enabled (for testing)
- **Analytics**: Enabled
- **Dev Tools**: Enabled

### `.env.production`
- **API URL**: `https://api.eagerdevelopers.ir/v1`
- **Debug Mode**: Disabled
- **Analytics**: Enabled
- **Dev Tools**: Disabled

### `.env.local` (Auto-generated)
- Created automatically when switching environments
- Takes highest precedence over other env files
- Contains the active environment configuration

## Environment Variables

### Required Variables
- `VITE_API_BASE_URL` - Backend API endpoint
- `VITE_API_TIMEOUT` - Request timeout in milliseconds

### Feature Flags
- `VITE_ENABLE_ANALYTICS` - Enable/disable analytics
- `VITE_ENABLE_DEBUG_MODE` - Enable/disable debug logging
- `VITE_ENABLE_DEV_TOOLS` - Enable/disable development tools

### Environment Identification
- `VITE_ENVIRONMENT_NAME` - Explicit environment name
- `VITE_SHOW_ENV_BADGE` - Show environment badge in UI

### Services (Optional)
- `VITE_ANALYTICS_KEY` - Google Analytics key
- `VITE_SENTRY_DSN` - Sentry error tracking DSN

## Usage in Code

```typescript
import { env, getApiUrl, getCurrentEnvironment, isEnvironment } from '@/config/environment';

// Get API base URL
const apiUrl = env.api.baseUrl;

// Build specific endpoint
const loginUrl = getApiUrl('/auth/login');

// Check current environment
const currentEnv = getCurrentEnvironment(); // 'development', 'staging', 'production'

// Environment-specific logic
if (isEnvironment('development')) {
  console.log('Running in development mode');
}

// Feature flags
if (env.features.enableAnalytics) {
  // Initialize analytics
}
```

## Deployment

### Development
```bash
pnpm env:switch development
pnpm dev
```

### Staging
```bash
pnpm env:switch staging
pnpm build:staging
```

### Production
```bash
pnpm env:switch production
pnpm build
```

## Environment Validation

The system automatically validates:
- ✅ Required environment variables are present
- ✅ API URLs are valid format
- ⚠️ Production-specific warnings (debug mode enabled, etc.)
- ❌ Missing configuration files

Run `pnpm env:check` to see detailed validation results.

## Best Practices

1. **Never commit `.env.local`** - It's auto-generated and git-ignored
2. **Use environment switching** - Don't manually edit `.env.local`
3. **Validate before deployment** - Always run `pnpm env:check`
4. **Test with production config** - Use `pnpm dev:prod` for testing
5. **Keep staging close to production** - Minimize configuration differences

## Troubleshooting

### Wrong API endpoint being used
```bash
# Check active environment
pnpm env:check

# Switch to correct environment
pnpm env:switch <environment>
```

### Environment variables not loading
1. Ensure the environment file exists (`.env.development`, etc.)
2. Check variable names start with `VITE_`
3. Restart development server after changes
4. Verify no syntax errors in env files

### Build errors
```bash
# Validate environment first
pnpm env:check

# Clean build
rm -rf dist
pnpm build
```

## Advanced Configuration

### Custom Environment
Create `.env.custom` and add it to the scripts:

```json
{
  "scripts": {
    "build:custom": "vite build --mode custom"
  }
}
```

### Local Overrides
Create `.env.local` manually for personal overrides:

```bash
# Personal API override
VITE_API_BASE_URL=http://192.168.1.100:3001/api
```

### CI/CD Integration
```bash
# In your CI/CD pipeline
pnpm env:switch production
pnpm build
```

## Environment File Priority (Highest to Lowest)
1. `.env.local` (auto-generated by switcher)
2. `.env.production` / `.env.development` / `.env.staging`  
3. `.env` (if exists)
4. Default values in code